<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProBusk Monitor - Sistema Operacional</title>
    <style>
        :root {
            --primary: #2c3e50; --secondary: #34495e; --success: #27ae60;
            --warning: #f39c12; --danger: #e74c3c; --light: #ecf0f1; --dark: #1a252f;
        }

        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; display: flex; color: #333; overflow-x: hidden; }
        
        /* Mobile Header */
        .mobile-header {
            display: none; width: 100%; background: var(--dark); color: white;
            padding: 15px; position: fixed; top: 0; z-index: 1000; justify-content: space-between; align-items: center; box-sizing: border-box;
        }

        /* Sidebar */
        .sidebar { 
            width: 260px; background: var(--dark); height: 100vh; color: white; 
            padding: 20px; position: fixed; transition: 0.3s; z-index: 999;
        }
        .sidebar h2 { font-size: 1.1rem; color: var(--warning); border-bottom: 1px solid #34495e; padding-bottom: 15px; margin-bottom: 20px; }
        
        .menu-item { padding: 12px 15px; cursor: pointer; border-radius: 5px; margin-bottom: 5px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover, .menu-item.active { background: var(--secondary); color: var(--warning); }

        /* Main Content */
        .main-content { margin-left: 260px; padding: 30px; width: calc(100% - 260px); transition: 0.3s; min-height: 100vh; box-sizing: border-box; }
        
        .view { display: none; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Estilos de Cart√µes e Grids */
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        
        /* Tabelas Responsivas */
        .table-container { width: 100%; overflow-x: auto; background: white; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f8f9fa; padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }

        /* Bot√µes e Inputs */
        .btn { padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .btn-run { background: var(--success); }
        .btn-save { background: var(--primary); }
        .btn-export { background: #e67e22; }
        
        .badge { padding: 5px 10px; border-radius: 4px; font-size: 0.7rem; color: white; font-weight: bold; }
        input, select { padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 100%; margin-top: 5px; box-sizing: border-box; margin-bottom: 10px; }
        
        #console-log { background: #000; color: #0f0; padding: 15px; font-family: monospace; height: 120px; overflow-y: auto; border-radius: 5px; font-size: 0.75rem; margin-top: 20px; }

        /* Overlay para Mobile */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 998; }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 992px) { .grid-3 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .mobile-header { display: flex; }
            .sidebar { left: -260px; padding-top: 80px; }
            .sidebar.open { left: 0; }
            .main-content { margin-left: 0; width: 100%; padding: 80px 15px 20px 15px; }
            .grid-3 { grid-template-columns: 1fr; }
            .overlay.active { display: block; }
        }
    </style>
</head>
<body>

    <div class="mobile-header">
        <span>‚öñÔ∏è LawTech Monitor</span>
        <button onclick="toggleMenu()" style="background:none; border:none; color:white; font-size:1.5rem;">‚ò∞</button>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="sidebar" id="sidebar">
        <h2>‚öñÔ∏è LawTech Monitor</h2>
        <div class="menu-item active" onclick="showView('dashboard')">üìä Dashboard</div>
        <div class="menu-item" onclick="showView('tribunais')">‚öôÔ∏è Configurar Tribunais</div>
        <div class="menu-item" onclick="showView('ramos')">‚öñÔ∏è Ramos do Direito</div>
        <div class="menu-item" onclick="showView('periodicidade')">üìÖ Periodicidade</div>
        <div class="menu-item" onclick="showView('alertas')">üì± Canais de Alerta</div>
        <div class="menu-item" onclick="showView('relatorios')">üìà Relat√≥rios</div>
    </div>

    <div class="main-content">
        
        <div id="dashboard" class="view active">
            <h1>Painel de Controle</h1>
            <button class="btn btn-run" onclick="executarBusca()">‚ö° EXECUTAR BUSCA AGORA</button>
            <div class="grid-3">
                <div class="card" style="border-top: 4px solid var(--danger)"><h3>Risco Alto</h3><p id="high-count" style="font-size: 1.5rem; font-weight: bold;">0</p></div>
                <div class="card" style="border-top: 4px solid var(--warning)"><h3>Risco M√©dio</h3><p id="med-count" style="font-size: 1.5rem; font-weight: bold;">0</p></div>
                <div class="card" style="border-top: 4px solid var(--success)"><h3>Alertas</h3><p id="sent-count" style="font-size: 1.5rem; font-weight: bold;">0</p></div>
            </div>
            <div class="card">
                <h3>Processos Detectados sem Defesa</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Processo</th><th>Ramo</th><th>Prazo Restante</th><th>Status</th><th>A√ß√£o</th></tr>
                        </thead>
                        <tbody id="lista-corpo"></tbody>
                    </table>
                </div>
            </div>
            <div id="console-log">> Aguardando comando...</div>
        </div>

        <div id="tribunais" class="view">
            <h1>‚öôÔ∏è Configurar Tribunais</h1>
            <div class="card">
                <p>Selecione as bases onde o rob√¥ far√° a busca autom√°tica:</p>
                <label><input type="checkbox" checked> TJSP - Tribunal de Justi√ßa de SP</label><br><br>
                <label><input type="checkbox" checked> TRT2 - Tribunal Regional do Trabalho</label><br><br>
                <label><input type="checkbox"> TJMG - Minas Gerais</label><br><br>
                <label><input type="checkbox" checked> API Jusbrasil (Consolidada)</label><br><br>
                <button class="btn btn-save" onclick="salvarConfig()">Salvar Fontes de Dados</button>
            </div>
        </div>

        <div id="ramos" class="view">
            <h1>‚öñÔ∏è Regras por Ramo</h1>
            <div class="card">
                <label>Prazo C√≠vel (Dias √öteis)</label>
                <input type="number" id="cfg-civel" value="15">
                <label>Prazo Trabalhista (Dias)</label>
                <input type="number" id="cfg-trab" value="5">
                <label>Prazo Penal (Dias Corridos)</label>
                <input type="number" id="cfg-penal" value="10">
                <button class="btn btn-save" onclick="salvarConfig()">Atualizar Prazos de Defesa</button>
            </div>
        </div>

        <div id="periodicidade" class="view">
            <h1>üìÖ Periodicidade das Buscas</h1>
            <div class="card">
                <label>Frequ√™ncia de Varredura</label>
                <select id="cfg-freq">
                    <option value="1">A cada 1 hora</option>
                    <option value="6" selected>A cada 6 horas (Recomendado)</option>
                    <option value="24">Uma vez ao dia</option>
                </select>
                <label>Hor√°rio de In√≠cio</label>
                <input type="time" value="08:00">
                <button class="btn btn-save" onclick="salvarConfig()">Agendar Tarefas do Rob√¥</button>
            </div>
        </div>

        <div id="alertas" class="view">
            <h1>üì± Canais de Comunica√ß√£o</h1>
            <div class="card">
                <label>E-mail para Alertas</label>
                <input type="email" value="contato@escritorio.com.br">
                <label>N√∫mero WhatsApp (DDI + DDD + Num)</label>
                <input type="text" id="cfg-whats" value="5511999999999">
                <label>Token API Evolution/Twilio</label>
                <input type="password" value="123456789">
                <button class="btn btn-save" style="background: #25D366" onclick="salvarConfig()">Testar Conex√£o WhatsApp</button>
            </div>
        </div>

        <div id="relatorios" class="view">
            <h1>üìä Relat√≥rios e Auditoria</h1>
            <div class="grid-3">
                <div class="card"><h4>Buscas Realizadas</h4><p>1.452</p></div>
                <div class="card"><h4>Efici√™ncia de Alerta</h4><p>98.7%</p></div>
                <div class="card"><h4>Alertas Totais</h4><p id="total-sent-rep">0</p></div>
            </div>
            <div class="card">
                <h3>Exporta√ß√£o de Dados</h3>
                <button class="btn btn-export">Exportar Excel (.csv)</button>
                <button class="btn btn-export" style="background: #c0392b;">Gerar PDF Mensal</button>
            </div>
        </div>

    </div>

    <script>
        let bancoSimulado = [
            { id: "1002345-12.2023", ramo: "C√≠vel", citacao: "2025-12-10", trib: "TJSP" },
            { id: "0010456-44.2023", ramo: "Trabalhista", citacao: "2025-12-19", trib: "TRT2" },
            { id: "1500789-90.2023", ramo: "Penal", citacao: "2025-12-21", trib: "TJSP" }
        ];
        let alertasContagem = 0;

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('active');
        }

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if(window.innerWidth <= 768) toggleMenu();
            event.currentTarget.classList.add('active');
        }

        function executarBusca() {
            log("Iniciando varredura conforme configura√ß√£o...");
            const corpo = document.getElementById('lista-corpo');
            corpo.innerHTML = "";
            let h = 0, m = 0;

            bancoSimulado.forEach(p => {
                let prazo = 0;
                if(p.ramo === "C√≠vel") prazo = document.getElementById('cfg-civel').value;
                else if(p.ramo === "Trabalhista") prazo = document.getElementById('cfg-trab').value;
                else prazo = document.getElementById('cfg-penal').value;

                const hoje = new Date();
                const inicio = new Date(p.citacao);
                const diff = Math.ceil((hoje - inicio) / (1000 * 60 * 60 * 24));
                const restante = prazo - diff;
                
                let nivel = "BAIXO", cor = "var(--success)";
                if (restante <= 2) { nivel = "ALTO"; cor = "var(--danger)"; h++; }
                else if (restante <= 5) { nivel = "M√âDIO"; cor = "var(--warning)"; m++; }

                corpo.innerHTML += `
                    <tr>
                        <td><b>${p.id}</b><br><small>${p.trib}</small></td>
                        <td>${p.ramo}</td>
                        <td>${restante}d</td>
                        <td><span class="badge" style="background:${cor}">${nivel}</span></td>
                        <td><button onclick="enviarAlerta('${p.id}')" style="cursor:pointer; border:none; background:none; font-size:1.2rem;">üì≤</button></td>
                    </tr>
                `;
            });
            document.getElementById('high-count').innerText = h;
            document.getElementById('med-count').innerText = m;
        }

        function enviarAlerta(id) {
            const num = document.getElementById('cfg-whats').value;
            alert(`Alerta WhatsApp enviado para ${num} sobre o processo ${id}`);
            alertasContagem++;
            document.getElementById('sent-count').innerText = alertasContagem;
            document.getElementById('total-sent-rep').innerText = alertasContagem;
            log("Alerta disparado via API para o processo: " + id);
        }

        function log(msg) {
            const c = document.getElementById('console-log');
            c.innerHTML += `<br>> [${new Date().toLocaleTimeString()}] ${msg}`;
            c.scrollTop = c.scrollHeight;
        }

        function salvarConfig() {
            log("Configura√ß√µes atualizadas no banco de dados.");
            alert("Sucesso: Novas regras aplicadas!");
            executarBusca();
        }

        // Inicializa√ß√£o
        executarBusca();
    </script>
</body>

</html>
